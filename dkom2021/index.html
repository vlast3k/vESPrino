<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
  <link href="https://vjs.zencdn.net/7.10.2/video-js.css" rel="stylesheet" />
  <!-- <link href="http://localhost:8080/dkom.css" rel="stylesheet" /> -->
  <!-- If you'd like to support IE8 (for Video.js versions prior to v7) -->
  <!-- <script src="https://vjs.zencdn.net/ie8/1.1.2/videojs-ie8.min.js"></script> -->
  <title>d-kom 2021 Sofia</title>
  <style>
      .nav-pills .nav-link.active {
        background-color: rgb(255, 200, 61);
        color: rgb(27, 26, 25);
      }
      .nav-pills .nav-link {
        color: whitesmoke;
      }
    </style>
</head>

<body style="background-color: #222222;">
  <ul class="nav nav-pills mb-2" id="pills-tab" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="pills-home-tab" data-bs-toggle="pill" data-bs-target="#pills-home" type="button" role="tab" aria-controls="pills-home" aria-selected="true">Track 1</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="pills-profile-tab" data-bs-toggle="pill" data-bs-target="#pills-profile" type="button" role="tab" aria-controls="pills-profile" aria-selected="false">Track 2</button>
    </li>
  </ul>
  <div class="tab-content" id="pills-tabContent">
    <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
      <video class="video-js"  id="vid1"  muted controls  width="720" preload="auto" data-setup="{}" ></video>
      <a target="_blank"  id="link1" > 
        <img   id="img1" width="100"/>
      </a>
    </div>
    <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
      <video class="video-js"  id="vid2"  muted controls  width="720" preload="auto" data-setup="{}" ></video>
      <a target="_blank"  id="link2" > <img   id="img2" width="100"/></a>
    </div>
  </div>      


  <script src="https://vjs.zencdn.net/7.10.2/video.min.js"></script>
  <script>
    const zp = (num, places) => String(num).padStart(places, '0')
    var ZOOM="https://raw.githubusercontent.com/vlast3k/vESPrino/gh-pages/dkom2021/zoom_logo.png";
    var TEAMS="https://raw.githubusercontent.com/vlast3k/vESPrino/gh-pages/dkom2021/teams_logo.png";
    var TIMER="http://vlast3k.github.io/vESPrino/dkom2021/timer1.mp4";
    var KEYNOTE="http://vlast3k.github.io/vESPrino/dkom2021/keynote1.mp4";
    var SESSION="http://vlast3k.github.io/vESPrino/dkom2021/1min.mp4";
    var SESSIONZOOM="http://vlast3k.github.io/vESPrino/dkom2021/1min.mp4zoom";
    var SESSIONTEAMS="http://vlast3k.github.io/vESPrino/dkom2021/1min.mp4teams";
    var ZIMA ="https://sap.sharepoint.com/sites/124250/Shared%20Documents/zimacap.PNG"
    var TREE="https://www.sciencenewsforstudents.org/wp-content/uploads/2020/04/1030_LL_trees-1028x579.png";
    var tr1 = [{start:0, type:"none", src:TIMER}]
    var tr2 = [{start:0, type:"none", src:SESSIONTEAMS}]
  
    var config = generateTrack("vid1", tr1).concat(generateTrack("vid2", tr2));
    // var config2 = [
    // { track: "vid1", start:"2021,1,11,6,0,0", src: "http://localhost:8080/1min.mp4",
    //     type: "video"},
    //     { track: "vid1", start:"2021,1,11,4,0,0", src: "https://8b6677f5-85f0-495d-81db-22121c6c3ce9.s3.eu-central-1.amazonaws.com/12h.mp4",
    //     type: "video"},
    //     { track: "vid1", start:"2021,1,11,1,0,0", src: "https://8b6677f5-85f0-495d-81db-22121c6c3ce9.s3.eu-central-1.amazonaws.com/12h.mp4",
    //     type: "video"},
    //     { track: "vid1", start:"2021,1,11,8,5,0", src: "http://localhost:8080/1min.mp4", type: "video"},
    //     { track: "vid1", start:"2021,1,11,8,6,0", src: "http://localhost:8080/1min.mp4", type: "link"},
    //     { track: "vid1", start:"2021,1,11,8,8,0", src: "http://localhost:8080/1min.mp4", type: "video"},
    //     { track: "vid1", start:"2021,1,11,7,40,0", src: "http://localhost:8080/1min.mp4", type: "video"},
    //     { track: "vid1", start:"2021,1,11,7,31,0", src: "http://localhost:8080/1min.mp4", type: "video"},
    //     { track: "vid1", start:"2021,1,11,7,32,0", src: "http://localhost:8080/1min.mp4", type: "video"},
    //     { track: "vid1", start:"2021,1,11,7,33,0", src: "http://localhost:8080/1min.mp4", type: "video"},
    //     { track: "vid1", start:"2021,1,11,7,34,0", src: "http://localhost:8080/1min.mp4", type: "video"},
    //     { track: "vid1", start:"2021,1,11,7,35,0", src: "http://localhost:8080/1min.mp4", type: "video"},
    //     { track: "vid1", start:"2021,1,11,7,36,0", src: "http://localhost:8080/1min.mp4", type: "video"},
    //     { track: "vid1", start:"2021,1,11,9,0,0", src: "https://8b6677f5-85f0-495d-81db-22121c6c3ce9.s3.eu-central-1.amazonaws.com/12h.mp4",
    //     type: "video"},
    //     { track: "vid1", start:"2021,1,11,8,0,0", src: "https://8b6677f5-85f0-495d-81db-22121c6c3ce9.s3.eu-central-1.amazonaws.com/12h.mp4",
    //     type: "video"},
    //     { track: "vid2", start:"2021,1,11,5,30,0", src: "https://teams.microsoft.com/l/meetup-join/19%3ameeting_MmI0OWM2M2EtYTFkYS00Y2M3LWIyOWMtMzdlMzJjMGI5NGFi%40thread.v2/0?context=%7b%22Tid%22%3a%2242f7676c-f455-423c-82f6-dc2d99791af7%22%2c%22Oid%22%3a%22debc9f8e-dcd6-44ec-a997-3e30ef1cc344%22%7d",
    //     type: "link"}

      
    // ];

    function d2s(d) {return `${d.getFullYear()},${zp(d.getMonth(),2)},${zp(d.getDate(),2)},${zp(d.getHours(),2)},${zp(d.getMinutes(),2)},${zp(d.getSeconds(),2)}`};
    function generateTrack(track, cfg) {
      var now = Date.now();
      var c = [];
      //var d = new Date(now);
      cfg.forEach(x => c.push({track:track, 
                               start: d2s(new Date(now + x.start*1000)), 
                               src:x.src, 
                               type: x.type}))
      return c;
    }
    
    function findCurrentSession(track) {
      var d = new Date();
      var sd = d2s(d);
      return  config.filter(x => x.track === track)
                    .sort((x,y) => -x.start.localeCompare(y.start))
                    .find(x => x.start.localeCompare(sd) <= 0);
    }

    function onVJSReady() {
      this.on('play', function ()  {
          var ses = findCurrentSession(this.id());
          var s = ses.start.split(",");
          var d = new Date(s[0], s[1], s[2], s[3], s[4], s[5]);
          var t = (Date.now() - d.getTime())/1000;
          console.log(t)
          this.currentTime((Date.now() - d.getTime())/1000);
        });
    }

    function setSession(track) {
      var active = currentSession[track];
      var real   = findCurrentSession(track);
      var player = videojs.players[track];
      var linkId = track.replace("vid", "link")
      var imgId = track.replace("vid", "img")
      if (!real) {
        console.log("real session not found!");
      }
      if (!active || active.start !== real.start) {
        console.log("Switching........")
        console.log(active);
        console.log(real);
        if (real.type === "video" && player) {
          player.src({type: "video/mp4", src: real.src});
          //if (!player.paused()) 
            player.play();
          currentSession[track] = real;
           document.getElementById(track).style.display="block";
           document.getElementById(linkId).style.display="none";
           document.getElementById(linkId).style.display="none";
        } else if (real.type === "link") {
          player && player.pause();
          document.getElementById(track).style.display="none";
          document.getElementById(linkId).style.display="block";
          document.getElementById(linkId).href = real.src;
          //document.getElementById(linkId).innerHTML = "link";
          document.getElementById(imgId).src = real.src.indexOf("teams") > -1 ?  TEAMS : ZOOM;
          currentSession[track] = real;
        } else if (real.type === "none") {
          player && player.pause();
          document.getElementById(track).style.display="none";
          document.getElementById(linkId).style.display="block";
          document.getElementById(linkId).href = ""
          document.getElementById(imgId).src = TREE;
          //document.getElementById(linkId).innerHTML = "NO SESSION";
          currentSession[track] = real;
        }
        
      }
    }

    // document.getElementById("vid1").style.display="none";
    // document.getElementById("vid2").style.display="none";
    document.getElementById("link1").style.display="none";
    document.getElementById("link2").style.display="none";
    videojs.getComponent('ControlBar').prototype.options_.children = ["playToggle",'fullscreenToggle', "volumePanel"];
    document.addEventListener('contextmenu', event => event.preventDefault());
    var currentSession = {};

    videojs("vid1", null, onVJSReady);
    videojs("vid2", null, onVJSReady);
    setSession("vid1");
    setSession("vid2");
    setInterval(() => {
      setSession("vid1");
      setSession("vid2");
    }, 1000);
    //   videojs("my-video").ready(function ()  {
    //   });
    // }
  </script>
  <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>
</body>
